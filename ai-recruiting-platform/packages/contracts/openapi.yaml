openapi: 3.0.3
info:
  title: AI Recruiting Platform API
  version: 1.0.0
  description: Production-grade AI recruiting platform with automated sourcing, scoring, and outreach
servers:
  - url: https://api.recruiting-platform.com/v1
    description: Production server
  - url: https://staging-api.recruiting-platform.com/v1
    description: Staging server

security:
  - BearerAuth: []
  - ApiKeyAuth: []

paths:
  /jobs:
    post:
      summary: Create a new job from JD
      operationId: jobs.create
      tags:
        - Jobs
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobCreateRequest'
      responses:
        '201':
          description: Job created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Job'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /jobs/{jobId}/publish:
    post:
      summary: Publish job to career page and ATS
      operationId: jobs.publish
      tags:
        - Jobs
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Job published successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobPublishResponse'

  /candidates:
    post:
      summary: Ingest candidate from resume or profile
      operationId: candidates.ingest
      tags:
        - Candidates
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CandidateIngestRequest'
      responses:
        '201':
          description: Candidate ingested successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Candidate'

  /candidates/{candidateId}/score:
    post:
      summary: Calculate FitScore for candidate
      operationId: candidates.score
      tags:
        - Candidates
      parameters:
        - name: candidateId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Score calculated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CandidateScoreResponse'

  /pipeline/move:
    post:
      summary: Move candidate to different pipeline stage
      operationId: pipeline.move
      tags:
        - Pipeline
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PipelineMoveRequest'
      responses:
        '200':
          description: Candidate moved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PipelineMoveResponse'

  /outreach/send:
    post:
      summary: Send outreach message to candidate
      operationId: outreach.send
      tags:
        - Outreach
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OutreachSendRequest'
      responses:
        '200':
          description: Message sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OutreachSendResponse'

  /schedule/propose:
    post:
      summary: Propose 3 interview slots to candidate
      operationId: schedule.propose
      tags:
        - Scheduling
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScheduleProposeRequest'
      responses:
        '200':
          description: Slots proposed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScheduleProposeResponse'

  /schedule/confirm:
    post:
      summary: Confirm interview slot
      operationId: schedule.confirm
      tags:
        - Scheduling
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScheduleConfirmRequest'
      responses:
        '200':
          description: Slot confirmed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScheduleConfirmResponse'

  /reports/roleHealth:
    post:
      summary: Get role health metrics
      operationId: reports.roleHealth
      tags:
        - Reports
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleHealthRequest'
      responses:
        '200':
          description: Health metrics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleHealthResponse'

  /prep/pack:
    post:
      summary: Generate interview prep pack
      operationId: prep.pack
      tags:
        - Preparation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PrepPackRequest'
      responses:
        '200':
          description: Prep pack generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrepPackResponse'

  /webhooks/outreach:
    post:
      summary: Webhook for outreach events
      operationId: webhooks.outreach
      tags:
        - Webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookEvent'
      responses:
        '200':
          description: Webhook processed successfully

  /webhooks/calendar:
    post:
      summary: Webhook for calendar events
      operationId: webhooks.calendar
      tags:
        - Webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookEvent'
      responses:
        '200':
          description: Webhook processed successfully

  /webhooks/ats:
    post:
      summary: Webhook for ATS events
      operationId: webhooks.ats
      tags:
        - Webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookEvent'
      responses:
        '200':
          description: Webhook processed successfully

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

  schemas:
    JobCreateRequest:
      type: object
      required:
        - jdText
      properties:
        jdText:
          type: string
          description: Job description text
        fileUrl:
          type: string
          description: URL to JD document (PDF/DOC)
        title:
          type: string
          description: Job title (auto-extracted if not provided)
        location:
          type: string
          description: Job location
        compensation:
          type: object
          properties:
            min:
              type: number
            max:
              type: number
            currency:
              type: string

    Job:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
        location:
          type: string
        requirements:
          type: array
          items:
            type: string
        mustHaves:
          type: array
          items:
            type: string
        niceToHaves:
          type: array
          items:
            type: string
        minYears:
          type: number
        compensation:
          type: object
          properties:
            min:
              type: number
            max:
              type: number
            currency:
              type: string
        status:
          type: string
          enum: [draft, published, closed]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    JobPublishResponse:
      type: object
      properties:
        publicUrl:
          type: string
        externalId:
          type: string
          description: ATS external ID if connected

    CandidateIngestRequest:
      type: object
      required:
        - jobId
      properties:
        jobId:
          type: string
        fileUrl:
          type: string
        emailParse:
          type: object
          properties:
            from:
              type: string
            subject:
              type: string
            body:
              type: string
        profile:
          type: object
          properties:
            linkedinUrl:
              type: string
            githubUrl:
              type: string
            stackoverflowUrl:
              type: string

    Candidate:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string
        phone:
          type: string
        location:
          type: string
        currentRole:
          type: string
        currentCompany:
          type: string
        yearsExperience:
          type: number
        skills:
          type: array
          items:
            type: string
        education:
          type: array
          items:
            type: object
        experience:
          type: array
          items:
            type: object
        resumeUrl:
          type: string
        linkedinUrl:
          type: string
        githubUrl:
          type: string
        stackoverflowUrl:
          type: string
        source:
          type: string
        stage:
          type: string
          enum: [new, screening, shortlist, interview, offer, hired, rejected]
        fitScore:
          type: number
        coverage:
          type: number
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CandidateScoreResponse:
      type: object
      properties:
        fitScore:
          type: number
          minimum: 0
          maximum: 100
        coverage:
          type: number
          minimum: 0
          maximum: 1
        redFlags:
          type: array
          items:
            $ref: '#/components/schemas/RedFlag'
        factors:
          type: array
          items:
            $ref: '#/components/schemas/ScoreFactor'
        evidence:
          type: array
          items:
            $ref: '#/components/schemas/Evidence'

    RedFlag:
      type: object
      properties:
        type:
          type: string
          enum: [short_tenure, comp_mismatch, visa_block, frequent_hops]
        severity:
          type: string
          enum: [low, medium, high]
        description:
          type: string
        evidence:
          type: string

    ScoreFactor:
      type: object
      properties:
        name:
          type: string
        weight:
          type: number
        score:
          type: number
        description:
          type: string

    Evidence:
      type: object
      properties:
        type:
          type: string
          enum: [skill_match, experience, education, project]
        text:
          type: string
        confidence:
          type: number
        location:
          type: string

    PipelineMoveRequest:
      type: object
      required:
        - candidateId
        - toStage
      properties:
        candidateId:
          type: string
        toStage:
          type: string
          enum: [new, screening, shortlist, interview, offer, hired, rejected]
        notes:
          type: string

    PipelineMoveResponse:
      type: object
      properties:
        candidate:
          $ref: '#/components/schemas/Candidate'
        activityId:
          type: string

    OutreachSendRequest:
      type: object
      required:
        - candidateId
        - templateId
      properties:
        candidateId:
          type: string
        templateId:
          type: string
        step:
          type: number
        personalization:
          type: object
          properties:
            skillHighlights:
              type: array
              items:
                type: string
            recentActivity:
              type: string
            impactLine:
              type: string

    OutreachSendResponse:
      type: object
      properties:
        messageId:
          type: string
        status:
          type: string

    ScheduleProposeRequest:
      type: object
      required:
        - candidateId
        - recruiterId
      properties:
        candidateId:
          type: string
        recruiterId:
          type: string
        duration:
          type: number
          default: 45
        availability:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              times:
                type: array
                items:
                  type: string

    ScheduleProposeResponse:
      type: object
      properties:
        slots:
          type: array
          items:
            $ref: '#/components/schemas/TimeSlot'

    TimeSlot:
      type: object
      properties:
        id:
          type: string
        start:
          type: string
          format: date-time
        end:
          type: string
          format: date-time
        timezone:
          type: string

    ScheduleConfirmRequest:
      type: object
      required:
        - candidateId
        - slotId
      properties:
        candidateId:
          type: string
        slotId:
          type: string

    ScheduleConfirmResponse:
      type: object
      properties:
        eventId:
          type: string
        meetingLink:
          type: string

    RoleHealthRequest:
      type: object
      required:
        - jobId
      properties:
        jobId:
          type: string

    RoleHealthResponse:
      type: object
      properties:
        healthIndex:
          type: number
          minimum: 0
          maximum: 100
        qualifiedOnHand:
          type: number
        newApps24h:
          type: number
        interviews7d:
          type: number
        replyRate:
          type: number
        stageDistribution:
          type: object
          properties:
            new:
              type: number
            screening:
              type: number
            shortlist:
              type: number
            interview:
              type: number
            offer:
              type: number
        risks:
          type: array
          items:
            type: string
        nextActions:
          type: array
          items:
            type: string

    PrepPackRequest:
      type: object
      required:
        - candidateId
      properties:
        candidateId:
          type: string

    PrepPackResponse:
      type: object
      properties:
        pdfUrl:
          type: string
        content:
          type: object
          properties:
            jdSummary:
              type: string
            candidateTimeline:
              type: array
              items:
                type: object
            gapMatrix:
              type: array
              items:
                type: object
            interviewGuide:
              type: array
              items:
                type: object
            rubric:
              type: object
            biasTips:
              type: array
              items:
                type: string

    WebhookEvent:
      type: object
      required:
        - type
        - timestamp
        - data
      properties:
        type:
          type: string
          enum: [outreach.opened, outreach.replied, outreach.bounced, calendar.created, calendar.updated, ats.sync]
        timestamp:
          type: string
          format: date-time
        data:
          type: object
        signature:
          type: string
          description: HMAC signature for verification

    Error:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
        correlationId:
          type: string
        details:
          type: object